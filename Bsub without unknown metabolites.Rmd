---
title: "Bsub without unknown"
author: "Yen-Kai Chen"
date: "14/05/2020"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#set up
GLDS138.as <- read.csv("GLDS138.as.csv", check.names = FALSE, header = TRUE)
utils::View(GLDS138.as)

## remove unknown metabolites
GLDS138 <- GLDS138.as[,1:151]

# Just B. subtilis
Bsub.as <- GLDS138[c(1:52),]
Bsub.as <- Bsub.as[,-3]

# Get rid of Control ASAP and Frozen - so just media and pellet
BsubMP <- Bsub.as[-c(1:8, 27:34),]
BsubMP$Label <- factor(BsubMP$Label)

# Just Pellet - the bacteria - comparison of just flight vs ground
BsubFG <- BsubMP[c(19:36),]
BsubFG$Label <- gsub("Pellet ", "", BsubFG$Label)
# write.csv(BsubFG,"GLDS138.BsubFG.as.csv", row.names = F) # used later for metaboanalyst

# Just Media consumed by the bacteria - F vs G
BsubMd <- BsubMP[c(1:18),]
BsubMd$Label <- gsub("Media ", "", BsubMd$Label)
```
# IPCA/PCA
```{r}
library(mixOmics)
X <- GLDS138[,4:ncol(GLDS138)]
MyResult.ipca$kurtosis # proceed with PCA
MyResult.pca <- pca(X, ncomp = 3, center = TRUE)
plotIndiv(MyResult.pca, comp = c(1,2), legend = TRUE, title = 'GLDS138: PCA',
          group = GLDS138.as$Label, legend.title = 'Treatment',
          ellipse = FALSE, style = "ggplot2", ind.names = FALSE, 
          pch = GLDS138.as$species, legend.title.pch = 'Species')
plotVar(MyResult.pca, cutoff = 0.8)


# B subtilis
X <- Bsub.as[,3:ncol(Bsub.as)]
MyResult.ipca <- ipca(X, ncomp = 3, mode="deflation")
MyResult.ipca$kurtosis 
MyResult.pca <- pca(X, ncomp = 3, center = TRUE)
plotIndiv(MyResult.pca, comp = c(1,2), legend = TRUE, title = 'B. subtilis: PCA',
          group = Bsub.as$Label, legend.title = 'Treatment',
          ellipse = TRUE, style = "ggplot2", ind.names = FALSE)
plotVar(MyResult.pca, cutoff = 0.8)
MyResult.pca

# Media and pellet
X <- BsubMP[,3:ncol(BsubMP)]
MyResult.ipca <- ipca(X, ncomp = 3, mode="deflation")
MyResult.ipca$kurtosis 
plotIndiv(MyResult.ipca, comp = c(1,2), legend = TRUE, title = 'B. subtilis - Media vs Pellet: IPCA',
          group = BsubMP$Label, legend.title = 'Treatment',
          ellipse = TRUE, style = "ggplot2", ind.names = FALSE)
plotVar(MyResult.ipca, cutoff = 0.8)

# Pellet - Flight vs Ground
X <- BsubFG[,3:ncol(BsubFG)]
MyResult.ipca <- ipca(X, ncomp = 4, mode="deflation")
MyResult.ipca$kurtosis 
plotIndiv(MyResult.ipca, comp = c(1,2), legend = TRUE, title = 'B. subtilis - Flight vs Ground: IPCA',
          group = BsubFG$Label, legend.title = 'Treatment',
          ellipse = TRUE, style = "ggplot2", ind.names = FALSE)
plotIndiv(MyResult.ipca, comp = c(1,2,3), legend = TRUE, title = 'B. subtilis - Flight vs Ground: IPCA',
          group = BsubFG$Label, legend.title = 'Treatment',
          ellipse = TRUE, style = "3d", ind.names = FALSE)
plotVar(MyResult.ipca, cutoff = 0.675)
MyResult.ipca$kurtosis # first two components
hist(MyResult.ipca$loadings$X[,1], main = "Histogram of IPC1's loadings", xlab = "IPC1 Loadings")
hist(MyResult.ipca$loadings$X[,2], main = "Histogram of IPC2's loadings", xlab = "IPC2 Loadings")
hist(MyResult.ipca$loadings$X[,3], main = "Histogram of IPC3's loadings", xlab = "IPC3 Loadings")

# Media - Flight vs Ground
X <- BsubMd[,3:ncol(BsubMd)]
MyResult.ipca <- ipca(X, ncomp = 3, mode="deflation")
MyResult.ipca$kurtosis 
plotIndiv(MyResult.ipca, comp = c(1,2), legend = TRUE, 
          title = 'B. subtilis consumed media - Flight vs Ground: IPCA',
          group = BsubMd$Label, legend.title = 'Treatment',
          ellipse = TRUE, style = "ggplot2", ind.names = FALSE)
plotVar(MyResult.ipca, cutoff = 0.8)

```
# top IPCA metabolites
```{r}
top_10_metab <- names(sort(abs(MyResult.pca$rotation[,1]), decreasing = TRUE)[1:10])
MyResult.pca$rotation[top_10_metab,1]

# top metabolites for PC2
top_10_metab <- names(sort(abs(MyResult.pca$rotation[,2]), decreasing = TRUE)[1:10])
MyResult.pca$rotation[top_10_metab,2]

# top metabolites for PC3
top_10_metab <- names(sort(abs(MyResult.pca$rotation[,3]), decreasing = TRUE)[1:10])
MyResult.pca$rotation[top_10_metab,3]




```















```{r}
devtools::session_info()
```