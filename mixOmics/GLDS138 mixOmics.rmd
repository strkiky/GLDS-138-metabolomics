---
title: "GLDS-138 with MixOmics"
author: "Yen-Kai Chen"
date: "11/04/2020"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
# Load set up
rm(list = ls())
setwd("C:/Users/strki/Documents/Git_R/GLDS-138 metabolomics/GLDS-138-metabolomics/mixOmics")
library(mixOmics)

BsubFG <- read.csv("GLDS138.BsubFG.csv", check.names = FALSE, header = TRUE, row.names = 1)

# autoscale function
autoscale <- function(a){
  colmean <- apply(a,2,mean) # column mean
  colsd <- apply(a, 2, sd) # col standard deviation
  cv <- sweep(a, 2, colmean, "-") # minus mean center
  cv <- sweep(cv, 2, colsd, "/") # divide by sd
  return(cv)
}

# Normalise
BsubFG.as <- BsubFG
BsubFG.as[,2:ncol(BsubFG.as)] <- autoscale(BsubFG[,2:ncol(BsubFG)])

X <- BsubFG.as[,2:ncol(BsubFG.as)]

MyResult.pca <- pca(X, ncomp = 3)

# Quick plots
plotIndiv(MyResult.pca, group = BsubFG.as$Label, ellipse = TRUE, style = "lattice", legend = TRUE, ind.names = FALSE, comp = c(1,2))
plotVar(MyResult.pca)

# sparse PCA
MyResult.spca <- spca(X, keepX = c(5,5)) # keep top 5 variables of PC1&2
plotIndiv(MyResult.spca, group = BsubFG.as$Label, ellipse = TRUE, style = "ggplot2", legend = TRUE, ind.names = FALSE, comp = c(1,2))
plotVar(MyResult.spca)

# Other PCA
plotIndiv(MyResult.pca, group = BsubFG.as$Label, ellipse = TRUE, style = "3d", legend = TRUE, ind.names = FALSE, 
          title = "Spaceflight vs Ground: Metabolites, PCA comp 1-2-3")
plotVar(MyResult.pca, cutoff = 0.8)
plotVar(MyResult.pca, cutoff =  0.8, style = "3d")
plot(MyResult.pca)
MyResult.pca
plotLoadings(MyResult.pca, ndisplay = 60,
             size.name = rel(0.55))



```
























```{r}
devtools::session_info()
```