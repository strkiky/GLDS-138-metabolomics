---
title: "GLDS-138 with MixOmics"
author: "Yen-Kai Chen"
date: "11/04/2020"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
# Load set up
rm(list = ls())
setwd("C:/Users/strki/Documents/Git_R/GLDS-138 metabolomics/GLDS-138-metabolomics/mixOmics")
library(mixOmics)

BsubFG <- read.csv("GLDS138.BsubFG.csv", check.names = FALSE, header = TRUE, row.names = 1)

# autoscale function
autoscale <- function(a){
  colmean <- apply(a,2,mean) # column mean
  colsd <- apply(a, 2, sd) # col standard deviation
  cv <- sweep(a, 2, colmean, "-") # minus mean center
  cv <- sweep(cv, 2, colsd, "/") # divide by sd
  return(cv)
}

# Normalise
BsubFG.as <- BsubFG
BsubFG.as[,2:ncol(BsubFG.as)] <- autoscale(BsubFG[,2:ncol(BsubFG)])

X <- BsubFG.as[,2:ncol(BsubFG.as)]
```
```{r}
# Quick Plots
MyResult.pca <- pca(X, ncomp = 3)
plotIndiv(MyResult.pca, group = BsubFG.as$Label, ellipse = TRUE, style = "lattice", legend = TRUE, ind.names = FALSE, comp = c(1,2))
plotVar(MyResult.pca)

# sparse PCA
MyResult.spca <- spca(X, keepX = c(5,5)) # keep top 5 variables of PC1&2
plotIndiv(MyResult.spca, group = BsubFG.as$Label, ellipse = TRUE, style = "ggplot2", legend = TRUE, ind.names = FALSE, comp = c(1,2))
plotVar(MyResult.spca)

# Other PCA
plotIndiv(MyResult.pca, group = BsubFG.as$Label, ellipse = TRUE, style = "3d", legend = TRUE, ind.names = FALSE, 
          title = "Spaceflight vs Ground: Metabolites, PCA comp 1-2-3")
plotVar(MyResult.pca, cutoff = 0.8)
plotVar(MyResult.pca, cutoff =  0.8, style = "3d")
plot(MyResult.pca)
MyResult.pca
plotLoadings(MyResult.pca, ndisplay = 60,
             size.name = rel(0.55))

# Variable selection with sparse PCA
MyResult.spca <- spca(X, ncomp = 3, keepX = c(15, 10, 5)) # top 15, 10, 5 metabolites from PC1, PC2 and PC3
plotIndiv(MyResult.spca, group = BsubFG.as$Label, 
          # pch = as.factor() if a second factor can be used
          legend = TRUE, legend.title = "Treatment", # legend.title.pch = 'if used'
          title = "Spaceflight vs Ground: Metabolites, sPCA comp 1-2",
          ellipse = TRUE)
plotVar(MyResult.spca, cex = 3)  
selectVar(MyResult.spca, comp = 1)$value
plotLoadings(MyResult.spca, comp = 1)
selectVar(MyResult.spca, comp = 2)$value
plotLoadings(MyResult.spca, comp = 2)
tune.pca(X)

```
#Partial Least Squares - Discriminant Analysis
```{r}
# set up
X <- BsubFG.as[,-1]
Y <- BsubFG.as$Label
summary(Y)
dim(X)
length(Y)

# PLS-DA
MyResult.plsda <- plsda(X,Y)
plotIndiv(MyResult.plsda)
plotVar(MyResult.plsda, cutoff = 0.7)

# sPLS-DA
MyResult.splsda <- splsda(X, Y, ncomp = 3, keepX = c(60,60,60))
plotIndiv(MyResult.splsda, ind.names = FALSE, legend = TRUE,
          ellipse = TRUE, star = TRUE, title = 'sPLS-DA on BsubFG.as',
          X.label = 'PLS-DA 1', Y.label = 'PLS-DA 2')
plotVar(MyResult.splsda)
selectVar(MyResult.splsda, comp = 1)$name

# Background prediction
background <- background.predict(MyResult.splsda, comp.predicted = 2,
                                 dist = "max.dist")
plotIndiv(MyResult.splsda, comp = 1:2, group = BsubFG.as$Label,
          ind.names = FALSE, title = "Maximum distance",
          legend = TRUE,  background = background)

# 


```























```{r}
devtools::session_info()
```